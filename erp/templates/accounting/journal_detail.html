{% extends "base.html" %}

{% block title %}Journal Entry #{{ entry.id }} - ERP{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Journal Entry #{{ entry.id }}</h1>
    <div class="actions">
        <a href="{{ url_for('accounting.journal') }}" class="btn btn-secondary">Back to Journal</a>
        {% if not entry.posted %}
        <form method="post" action="{{ url_for('accounting.journal_post', id=entry.id) }}" style="display:inline;" onsubmit="return confirm('Post this journal entry? This will update account balances and cannot be undone.');">
            <button type="submit" class="btn btn-success">Post Entry</button>
        </form>
        {% endif %}
    </div>
</div>

<div class="card">
    <div class="detail-grid mb-1">
        <div class="detail-item">
            <label>Date</label>
            <div class="value">{{ entry.entry_date }}</div>
        </div>
        <div class="detail-item">
            <label>Reference</label>
            <div class="value">{{ entry.reference or '-' }}</div>
        </div>
        <div class="detail-item">
            <label>Description</label>
            <div class="value">{{ entry.description or '-' }}</div>
        </div>
        <div class="detail-item">
            <label>Status</label>
            <div class="value">
                {% if entry.posted %}
                <span class="badge badge-paid">Posted</span>
                {% else %}
                <span class="badge badge-draft">Draft</span>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="card">
    <h3>Lines</h3>
    <table>
        <thead>
            <tr>
                <th>Account Code</th>
                <th>Account Name</th>
                <th class="text-right">Debit</th>
                <th class="text-right">Credit</th>
            </tr>
        </thead>
        <tbody>
            {% set ns = namespace(total_debit=0, total_credit=0) %}
            {% for line in lines %}
            <tr>
                <td>{{ line.account_code }}</td>
                <td>{{ line.account_name }}</td>
                <td class="text-right">{% if line.debit %}${{ "%.2f"|format(line.debit) }}{% endif %}</td>
                <td class="text-right">{% if line.credit %}${{ "%.2f"|format(line.credit) }}{% endif %}</td>
            </tr>
            {% set ns.total_debit = ns.total_debit + line.debit %}
            {% set ns.total_credit = ns.total_credit + line.credit %}
            {% endfor %}
        </tbody>
        <tfoot>
            <tr style="font-weight: 700; border-top: 2px solid var(--text);">
                <td colspan="2" class="text-right">Total</td>
                <td class="text-right">${{ "%.2f"|format(ns.total_debit) }}</td>
                <td class="text-right">${{ "%.2f"|format(ns.total_credit) }}</td>
            </tr>
        </tfoot>
    </table>
</div>
{% endblock %}
