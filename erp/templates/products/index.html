{% extends "base.html" %}
{% block title %}Products - ERP{% endblock %}
{% block content %}
<div class="page-header">
    <h1>Products</h1>
    <div class="actions">
        <a href="{{ url_for('products.categories') }}" class="btn btn-secondary">Categories</a>
        <a href="{{ url_for('products.new') }}" class="btn btn-primary">New Product</a>
    </div>
</div>
<div class="card">
    <table>
        <thead>
            <tr>
                <th>SKU</th>
                <th>Name</th>
                <th>Category</th>
                <th class="text-right">Unit Price</th>
                <th class="text-right">Cost Price</th>
                <th class="text-right">Stock Qty</th>
                <th>Unit</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for p in products %}
            <tr>
                <td>{{ p.sku }}</td>
                <td><a href="{{ url_for('products.detail', id=p.id) }}">{{ p.name }}</a></td>
                <td>{{ p.category_name or '-' }}</td>
                <td class="text-right">{{ "%.2f"|format(p.unit_price) }}</td>
                <td class="text-right">{{ "%.2f"|format(p.cost_price) }}</td>
                <td class="text-right{% if p.stock_qty < p.reorder_level %} stock-low{% endif %}">
                    {{ "%.0f"|format(p.stock_qty) if p.stock_qty == p.stock_qty|int else p.stock_qty }}
                    {% if p.stock_qty < p.reorder_level %}
                    <span class="badge badge-cancelled">Low</span>
                    {% endif %}
                </td>
                <td>{{ p.unit }}</td>
                <td class="actions">
                    <a href="{{ url_for('products.detail', id=p.id) }}" class="btn btn-secondary btn-sm">View</a>
                    <a href="{{ url_for('products.edit', id=p.id) }}" class="btn btn-primary btn-sm">Edit</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="8" class="text-center">No products found. <a href="{{ url_for('products.new') }}">Create one</a>.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<style>
    .stock-low { color: var(--danger); font-weight: 600; }
</style>
{% endblock %}
