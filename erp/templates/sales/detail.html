{% extends "base.html" %}
{% block title %}{{ order.order_number }} - ERP{% endblock %}
{% block content %}
<div class="page-header">
    <h1>{{ order.order_number }}</h1>
    <div class="actions">
        {% if order.status == 'draft' %}
        <a href="{{ url_for('sales.edit', id=order.id) }}" class="btn btn-secondary">Edit</a>
        <form method="post" action="{{ url_for('sales.confirm', id=order.id) }}" style="display:inline;">
            <button type="submit" class="btn btn-primary">Confirm</button>
        </form>
        <form method="post" action="{{ url_for('sales.cancel', id=order.id) }}" style="display:inline;" onsubmit="return confirm('Cancel this order?');">
            <button type="submit" class="btn btn-danger">Cancel</button>
        </form>
        {% elif order.status == 'confirmed' or order.status == 'shipped' %}
        <form method="post" action="{{ url_for('sales.create_invoice', id=order.id) }}" style="display:inline;">
            <button type="submit" class="btn btn-success">Create Invoice</button>
        </form>
        <form method="post" action="{{ url_for('sales.cancel', id=order.id) }}" style="display:inline;" onsubmit="return confirm('Cancel this order?');">
            <button type="submit" class="btn btn-danger">Cancel</button>
        </form>
        {% endif %}
        <a href="{{ url_for('sales.index') }}" class="btn btn-secondary">Back to List</a>
    </div>
</div>

<div class="card">
    <div class="detail-grid">
        <div class="detail-item">
            <label>Order Number</label>
            <div class="value">{{ order.order_number }}</div>
        </div>
        <div class="detail-item">
            <label>Status</label>
            <div class="value"><span class="badge badge-{{ order.status }}">{{ order.status }}</span></div>
        </div>
        <div class="detail-item">
            <label>Customer</label>
            <div class="value">{{ order.customer_name }}</div>
        </div>
        <div class="detail-item">
            <label>Order Date</label>
            <div class="value">{{ order.order_date }}</div>
        </div>
        {% if order.notes %}
        <div class="detail-item" style="grid-column: span 2;">
            <label>Notes</label>
            <div class="value">{{ order.notes }}</div>
        </div>
        {% endif %}
    </div>
</div>

<div class="card">
    <h3>Line Items</h3>
    <table>
        <thead>
            <tr>
                <th>Product</th>
                <th class="text-right">Quantity</th>
                <th class="text-right">Unit Price</th>
                <th class="text-right">Line Total</th>
            </tr>
        </thead>
        <tbody>
            {% for line in lines %}
            <tr>
                <td>{{ line.product_name }}</td>
                <td class="text-right">{{ line.quantity }}</td>
                <td class="text-right">${{ "%.2f"|format(line.unit_price) }}</td>
                <td class="text-right">${{ "%.2f"|format(line.line_total) }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="4" class="text-center">No line items.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="totals">
        <div class="total-line"><span>Subtotal:</span> <span>${{ "%.2f"|format(order.subtotal) }}</span></div>
        <div class="total-line"><span>Tax (10%):</span> <span>${{ "%.2f"|format(order.tax_amount) }}</span></div>
        <div class="total-line grand-total"><span>Total:</span> <span>${{ "%.2f"|format(order.total) }}</span></div>
    </div>
</div>
{% endblock %}
